<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTML Parser</title>
</head>

<style type="text/css">
  @import "css/reset.css";
  @import "css/index.css";
</style>

<script src="scripts/axios.min.js"></script>
<script type="text/javascript">

  const validateUrl = (url) => {
    const reg = /https?:\/\/w{0,3}\w*?\.(\w*?\.)?\w{2,3}\S*|www\.(\w*?\.)?\w*?\.\w{2,3}\S*|(\w*?\.)?\w*?\.\w{2,3}[\/\?]\S*/;
    return reg.test(url);
  }

  const validateBunch = (bunch) => {
    try {
      return parseInt(bunch) > 0;
    } catch (e) {
      return false;
    }
  }

  const getParameterObject = () => {
    return {
      url: document.getElementById('input_url').value,
      type: document.getElementById('select_type').value,
      bunch: document.getElementById('input_bunch').value,
    }
  }

  const showLoading = () => {
    document.getElementById('loading').style.display = 'flex';
    document.getElementById('btn_request').disabled = true;
  }

  const hideLoading = () => {
    document.getElementById('loading').style.display = 'none';
    document.getElementById('btn_request').disabled = false;
  }

  document.addEventListener("DOMContentLoaded", (evt) => {

    document.getElementById('btn_request').addEventListener('click', () => {
      const params = getParameterObject();
      if(!validateUrl(params.url)) {
        alert('올바른 url을 입력해주세요.');
        return;
      }
      if(!validateBunch(params.bunch)) {
        alert('몫은 자연수를 입력해주세요.');
        return;
      }
      showLoading();
      axios
        .post('/parser', params)
        .then((res) => {
          hideLoading();
          const data = res.data;
          const status = data.status;
          if(status === 200) {

          } else {
            alert('['+status+'] '+data.message + '\n' + data.description);
          }
        })
        .catch((err) => {
          hideLoading();
          console.error(err);
        });
    })
  });

</script>

<body>
<div class="wrap flex_center">
    <div class="form flex_center">
        <table>
            <tr>
                <th>URL</th>
                <td>
                    <label><input type="text" required id="input_url"></label>
                </td>
            </tr>
            <tr>
                <th>Type</th>
                <td>
                    <label>
                        <select id="select_type">
                            <option value="HTML">전체</option>
                            <option value="TEXT">HTML 태그제외</option>
                        </select>
                    </label>
                </td>
            </tr>
            <tr>
                <th>출력 묶음 단위 (자연수)</th>
                <td>
                    <label><input type="number" id="input_bunch"></label>
                </td>
            </tr>
            <tr>
                <td colspan="2"><button id="btn_request">요청</button></td>
            </tr>
        </table>
    </div>
    <div class="bunch flex_center">
        <p>몫</p>
    </div>
    <div class="remainder flex_center">
        <p>나머지</p>
    </div>
</div>
<div id="loading">
    <img id="img_loading" src="images/loading.gif" alt="loading...">
</div>
</body>
</html>